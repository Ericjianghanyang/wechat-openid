<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>微信 OpenID 獲取系統</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #007bff;
        }
        .step {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .step h3 {
            color: #007bff;
            margin-top: 0;
        }
        .btn {
            background-color: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin: 10px;
            font-size: 16px;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        .btn-success {
            background-color: #28a745;
        }
        .btn-success:hover {
            background-color: #218838;
        }
        .btn-warning {
            background-color: #ffc107;
            color: #212529;
        }
        .btn-warning:hover {
            background-color: #e0a800;
        }
        .info-box {
            background-color: #e7f3ff;
            border: 1px solid #b8daff;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .warning-box {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .success-box {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
            margin: 10px 0;
            font-size: 12px;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
        }
        .status-success {
            background-color: #28a745;
            color: white;
        }
        .status-warning {
            background-color: #ffc107;
            color: #212529;
        }
        .status-error {
            background-color: #dc3545;
            color: white;
        }
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .tool-card {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            background-color: white;
        }
        .tool-card h4 {
            margin-top: 0;
            color: #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>微信 OpenID 獲取系統</h1>
            <p>完整的微信網頁授權解決方案</p>
        </div>

        <div class="step">
            <h3>📋 系統狀態檢查</h3>
            <div class="info-box">
                <p><strong>域名：</strong> openid.meditechmacao.com <span class="status status-success">已配置</span></p>
                <p><strong>部署平台：</strong> Vercel <span class="status status-success">已部署</span></p>
                <p><strong>HTTPS：</strong> 已啟用 <span class="status status-success">安全</span></p>
                <p><strong>微信公眾號：</strong> wxe877716401fdb4c9 <span class="status status-warning">需配置</span></p>
            </div>
        </div>

        <div class="step">
            <h3>🔧 第一步：微信公眾平台配置</h3>
            <div class="warning-box">
                <h4>重要提醒：</h4>
                <ul>
                    <li>確保您的公眾號是<strong>服務號</strong>且<strong>已認證</strong></li>
                    <li>訂閱號功能受限，可能無法正常使用網頁授權</li>
                </ul>
            </div>
            
            <h4>1.1 設置網頁授權域名</h4>
            <ol>
                <li>登錄微信公眾平台</li>
                <li>進入「設置」→「公眾號設置」→「功能設置」</li>
                <li>在「網頁授權域名」中填入：<code>openid.meditechmacao.com</code></li>
                <li>按照指示上傳驗證文件到網站根目錄</li>
            </ol>

            <h4>1.2 創建自定義菜單</h4>
            <ol>
                <li>進入「自定義菜單」設置頁面</li>
                <li>添加新菜單項，選擇「跳轉網頁」類型</li>
                <li>使用下面的工具生成授權 URL</li>
            </ol>
        </div>

        <div class="step">
            <h3>🛠️ 第二步：使用工具生成授權 URL</h3>
            <div class="tools-grid">
                <div class="tool-card">
                    <h4>授權 URL 生成器</h4>
                    <p>生成標準的微信授權 URL，包含正確的 URL 編碼</p>
                    <a href="/auth-url-generator.html" class="btn">打開生成器</a>
                </div>
                <div class="tool-card">
                    <h4>URL 編碼測試</h4>
                    <p>測試不同的 URL 編碼方式，確保格式正確</p>
                    <a href="/url-encoding-test.html" class="btn">打開測試工具</a>
                </div>
            </div>
        </div>

        <div class="step">
            <h3>📱 第三步：測試授權流程</h3>
            <div class="info-box">
                <h4>標準授權 URL 格式：</h4>
                <div class="code-block">https://open.weixin.qq.com/connect/oauth2/authorize?appid=YOUR_APPID&redirect_uri=YOUR_REDIRECT_URL&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect</div>
            </div>

            <h4>測試步驟：</h4>
            <ol>
                <li>使用工具生成授權 URL</li>
                <li>將 URL 設置到微信公眾平台自定義菜單</li>
                <li><strong>在手機微信中點擊菜單</strong>（重要：不要用電腦瀏覽器）</li>
                <li>確認授權後會跳轉到 callback 頁面</li>
                <li>查看獲取的用戶信息</li>
            </ol>

            <div class="warning-box">
                <h4>常見問題：</h4>
                <ul>
                    <li><strong>404 錯誤：</strong>檢查網頁授權域名是否正確配置</li>
                    <li><strong>空白頁面：</strong>確保 callback 頁面能正常訪問</li>
                    <li><strong>授權失敗：</strong>確認公眾號類型和認證狀態</li>
                </ul>
            </div>
        </div>

        <div class="step">
            <h3>🔍 第四步：調試和監控</h3>
            <div class="tools-grid">
                <div class="tool-card">
                    <h4>授權回調處理</h4>
                    <p>處理微信授權回調，獲取用戶信息</p>
                    <a href="/callback.html" class="btn">查看回調頁面</a>
                </div>
                <div class="tool-card">
                    <h4>環境變量檢查</h4>
                    <p>檢查服務器配置是否正確</p>
                    <a href="/api/debug/env" class="btn">檢查配置</a>
                </div>
            </div>
        </div>

        <div class="step">
            <h3>📚 技術文檔</h3>
            <div class="info-box">
                <h4>API 端點：</h4>
                <ul>
                    <li><strong>授權處理：</strong> <code>POST /api/wechat/process-auth</code></li>
                    <li><strong>環境檢查：</strong> <code>GET /api/debug/env</code></li>
                </ul>
            </div>

            <h4>重要文件：</h4>
            <ul>
                <li><code>public/callback.html</code> - 授權回調處理頁面</li>
                <li><code>api/wechat/process-auth.js</code> - 後端授權處理 API</li>
                <li><code>public/auth-url-generator.html</code> - 授權 URL 生成器</li>
            </ul>
        </div>

        <div class="step">
            <h3>✅ 完成檢查清單</h3>
            <div class="success-box">
                <h4>請確認以下項目：</h4>
                <ul>
                    <li>✅ 域名已配置並可訪問</li>
                    <li>✅ HTTPS 已啟用</li>
                    <li>✅ 微信公眾號 AppID 已設置</li>
                    <li>✅ 網頁授權域名已配置</li>
                    <li>✅ 自定義菜單已設置</li>
                    <li>✅ 在手機微信中測試通過</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // 檢查系統狀態
        async function checkSystemStatus() {
            try {
                const response = await fetch('/api/debug/env');
                const data = await response.json();
                console.log('系統配置:', data);
            } catch (error) {
                console.error('檢查系統狀態失敗:', error);
            }
        }

        // 頁面加載時檢查狀態
        document.addEventListener('DOMContentLoaded', checkSystemStatus);
    </script>
</body>
</html> 