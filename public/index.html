<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾®ä¿¡ç¶²é æˆæ¬Šç³»çµ± - å®˜æ–¹æ¨™æº–å¯¦ç¾</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #007bff;
        }
        .step {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .step h3 {
            color: #007bff;
            margin-top: 0;
        }
        .btn {
            background-color: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin: 10px;
            font-size: 16px;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        .btn-success {
            background-color: #28a745;
        }
        .btn-success:hover {
            background-color: #218838;
        }
        .info-box {
            background-color: #e7f3ff;
            border: 1px solid #b8daff;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .warning-box {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .success-box {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
            margin: 10px 0;
            font-size: 12px;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
        }
        .status-success {
            background-color: #28a745;
            color: white;
        }
        .status-warning {
            background-color: #ffc107;
            color: #212529;
        }
        .status-error {
            background-color: #dc3545;
            color: white;
        }
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .tool-card {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            background-color: white;
        }
        .tool-card h4 {
            margin-top: 0;
            color: #007bff;
        }
        .api-section {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .api-section h4 {
            margin-top: 0;
            color: #495057;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>å¾®ä¿¡ç¶²é æˆæ¬Šç³»çµ±</h1>
            <p>æŒ‰ç…§å¾®ä¿¡å®˜æ–¹æ–‡æª”å¯¦ç¾çš„æ¨™æº–ç¶²é æˆæ¬Šç³»çµ±</p>
        </div>

        <div class="step">
            <h3>ğŸ“‹ ç³»çµ±æ¦‚è¿°</h3>
            <div class="info-box">
                <h4>å¾®ä¿¡ç¶²é æˆæ¬Šæµç¨‹ï¼ˆå®˜æ–¹æ¨™æº–ï¼‰ï¼š</h4>
                <ol>
                    <li><strong>ç¬¬ä¸€æ­¥ï¼š</strong>å¼•å°ç”¨æˆ¶é€²å…¥æˆæ¬Šé é¢</li>
                    <li><strong>ç¬¬äºŒæ­¥ï¼š</strong>æ¥å—ç”¨æˆ¶æˆæ¬ŠåŒæ„ï¼Œåœ¨å›èª¿é é¢ä¸­ç²å–code</li>
                    <li><strong>ç¬¬ä¸‰æ­¥ï¼š</strong>é€šécodeæ›å–ç”¨æˆ¶æˆæ¬Šaccess_token</li>
                    <li><strong>ç¬¬å››æ­¥ï¼š</strong>é€šéç”¨æˆ¶æˆæ¬Šaccess_tokenå’Œopenidç²å–ç”¨æˆ¶åŸºæœ¬ä¿¡æ¯</li>
                </ol>
            </div>
        </div>

        <div class="step">
            <h3>ğŸ”§ ç¬¬ä¸€æ­¥ï¼šæ§‹é€ æˆæ¬Šéˆæ¥</h3>
            <div class="warning-box">
                <h4>é–‹ç™¼å‰å¿…è®€ï¼š</h4>
                <ul>
                    <li><strong>é©ç”¨è³¬è™Ÿï¼š</strong>åƒ…æ”¯æŒå·²èªè­‰çš„æœå‹™è™Ÿ</li>
                    <li><strong>ç¶²é æˆæ¬ŠåŸŸåï¼š</strong>å¿…é ˆåœ¨å…¬çœ¾å¹³å°é…ç½® openid.meditechmacao.com</li>
                    <li><strong>HTTPSè¦æ±‚ï¼š</strong>redirect_uri å¿…é ˆä½¿ç”¨ https å”è­°</li>
                </ul>
            </div>

            <div class="info-box">
                <h4>æˆæ¬Šéˆæ¥æ ¼å¼ï¼ˆå®˜æ–¹æ¨™æº–ï¼‰ï¼š</h4>
                <div class="code-block">https://open.weixin.qq.com/connect/oauth2/authorize?appid=APPID&redirect_uri=REDIRECT_URI&response_type=code&scope=SCOPE&state=STATE#wechat_redirect</div>
            </div>

            <div class="tools-grid">
                <div class="tool-card">
                    <h4>æˆæ¬Šé é¢</h4>
                    <p>æ§‹é€ æ¨™æº–çš„å¾®ä¿¡æˆæ¬Šéˆæ¥ï¼ŒåŒ…å«å®Œæ•´çš„åƒæ•¸é©—è­‰</p>
                    <a href="/oauth.html" class="btn">æ‰“é–‹æˆæ¬Šé é¢</a>
                </div>
            </div>
        </div>

        <div class="step">
            <h3>ğŸ“± ç¬¬äºŒæ­¥ï¼šæˆæ¬Šå›èª¿è™•ç†</h3>
            <div class="info-box">
                <h4>æˆæ¬ŠæˆåŠŸå¾Œï¼Œå¾®ä¿¡æœƒé‡å®šå‘åˆ°ï¼š</h4>
                <div class="code-block">redirect_uri/?code=CODE&state=STATE</div>
                <ul>
                    <li><strong>codeï¼š</strong>ä½œç‚ºæ›å–access_tokençš„ç¥¨æ“šï¼Œåªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œ5åˆ†é˜éæœŸ</li>
                    <li><strong>stateï¼š</strong>é˜²æ­¢è¶Šæ¬Šè¡Œç‚ºçš„ç‹€æ…‹åƒæ•¸</li>
                </ul>
            </div>

            <div class="tools-grid">
                <div class="tool-card">
                    <h4>å›èª¿è™•ç†é é¢</h4>
                    <p>è™•ç†å¾®ä¿¡æˆæ¬Šå›èª¿ï¼Œç²å–codeåƒæ•¸</p>
                    <a href="/callback.html" class="btn">æŸ¥çœ‹å›èª¿é é¢</a>
                </div>
            </div>
        </div>

        <div class="step">
            <h3>ğŸ”‘ ç¬¬ä¸‰æ­¥ï¼šå¾Œç«¯APIæ¥å£</h3>
            <div class="api-section">
                <h4>1. ç²å–ç”¨æˆ¶æˆæ¬Šä¿¡æ¯æ¥å£</h4>
                <p><strong>APIï¼š</strong> <code>POST /api/wechat/oauth2/access_token</code></p>
                <p><strong>åŠŸèƒ½ï¼š</strong>é€šé code æ›å–ç”¨æˆ¶æˆæ¬Š access_token</p>
                <p><strong>å®˜æ–¹æ¥å£ï¼š</strong> <code>https://api.weixin.qq.com/sns/oauth2/access_token</code></p>
            </div>

            <div class="api-section">
                <h4>2. åˆ·æ–°æˆæ¬ŠTokenæ¥å£</h4>
                <p><strong>APIï¼š</strong> <code>POST /api/wechat/oauth2/refresh_token</code></p>
                <p><strong>åŠŸèƒ½ï¼š</strong>ä½¿ç”¨ refresh_token åˆ·æ–° access_token</p>
                <p><strong>å®˜æ–¹æ¥å£ï¼š</strong> <code>https://api.weixin.qq.com/sns/oauth2/refresh_token</code></p>
            </div>

            <div class="api-section">
                <h4>3. æª¢é©—Tokenæœ‰æ•ˆæ€§æ¥å£</h4>
                <p><strong>APIï¼š</strong> <code>POST /api/wechat/oauth2/auth</code></p>
                <p><strong>åŠŸèƒ½ï¼š</strong>æª¢é©—æˆæ¬Š access_token æ˜¯å¦æœ‰æ•ˆ</p>
                <p><strong>å®˜æ–¹æ¥å£ï¼š</strong> <code>https://api.weixin.qq.com/sns/auth</code></p>
            </div>
        </div>

        <div class="step">
            <h3>ğŸ‘¤ ç¬¬å››æ­¥ï¼šç²å–ç”¨æˆ¶ä¿¡æ¯</h3>
            <div class="info-box">
                <h4>æˆæ¬Šä½œç”¨åŸŸèªªæ˜ï¼š</h4>
                <ul>
                    <li><strong>snsapi_baseï¼š</strong>éœé»˜æˆæ¬Šï¼Œåªèƒ½ç²å–ç”¨æˆ¶openid</li>
                    <li><strong>snsapi_userinfoï¼š</strong>å½ˆå‡ºæˆæ¬Šé é¢ï¼Œå¯ç²å–ç”¨æˆ¶åŸºæœ¬ä¿¡æ¯ï¼ˆæ˜µç¨±ã€é ­åƒç­‰ï¼‰</li>
                </ul>
            </div>

            <div class="warning-box">
                <h4>é‡è¦æé†’ï¼š</h4>
                <ul>
                    <li>ç”±æ–¼æœå‹™è™Ÿçš„ secret å’Œç²å–åˆ°çš„ access_token å®‰å…¨ç´šåˆ¥éƒ½éå¸¸é«˜ï¼Œå¿…é ˆåªä¿å­˜åœ¨æœå‹™å™¨</li>
                    <li>ä¸å…è¨±å‚³çµ¦å®¢æˆ¶ç«¯</li>
                    <li>å¾ŒçºŒåˆ·æ–°access_tokenã€é€šéaccess_tokenç²å–ç”¨æˆ¶ä¿¡æ¯ç­‰æ­¥é©Ÿï¼Œä¹Ÿå¿…é ˆå¾æœå‹™å™¨ç™¼èµ·</li>
                </ul>
            </div>
        </div>

        <div class="step">
            <h3>ğŸš€ æ¸¬è©¦æµç¨‹</h3>
            <div class="success-box">
                <h4>å®Œæ•´æ¸¬è©¦æ­¥é©Ÿï¼š</h4>
                <ol>
                    <li>ç¢ºä¿ç¶²é æˆæ¬ŠåŸŸåå·²é…ç½®ï¼š<code>openid.meditechmacao.com</code></li>
                    <li>åœ¨å¾®ä¿¡å…¬çœ¾å¹³å°è¨­ç½®è‡ªå®šç¾©èœå–®ï¼Œä½¿ç”¨æˆæ¬Šéˆæ¥</li>
                    <li><strong>åœ¨æ‰‹æ©Ÿå¾®ä¿¡ä¸­é»æ“Šèœå–®</strong>ï¼ˆé‡è¦ï¼šä¸è¦ç”¨é›»è…¦ç€è¦½å™¨ï¼‰</li>
                    <li>ç¢ºèªæˆæ¬Šå¾Œæœƒè·³è½‰åˆ°å›èª¿é é¢</li>
                    <li>æŸ¥çœ‹ç²å–çš„ç”¨æˆ¶ä¿¡æ¯</li>
                </ol>
            </div>
        </div>

        <div class="step">
            <h3>ğŸ“š æŠ€è¡“æ–‡æª”</h3>
            <div class="info-box">
                <h4>é‡è¦æ–‡ä»¶ï¼š</h4>
                <ul>
                    <li><code>public/oauth.html</code> - æˆæ¬Šéˆæ¥æ§‹é€ é é¢</li>
                    <li><code>public/callback.html</code> - æˆæ¬Šå›èª¿è™•ç†é é¢</li>
                    <li><code>api/wechat/oauth2/access_token.js</code> - ç²å–æˆæ¬ŠToken API</li>
                    <li><code>api/wechat/oauth2/refresh_token.js</code> - åˆ·æ–°Token API</li>
                    <li><code>api/wechat/oauth2/auth.js</code> - Tokené©—è­‰ API</li>
                </ul>
            </div>

            <div class="info-box">
                <h4>ç’°å¢ƒè®Šé‡é…ç½®ï¼š</h4>
                <ul>
                    <li><code>WECHAT_APPID</code> - å¾®ä¿¡å…¬çœ¾è™Ÿ AppID</li>
                    <li><code>WECHAT_SECRET</code> - å¾®ä¿¡å…¬çœ¾è™Ÿ AppSecret</li>
                    <li><code>BASE_URL</code> - ç¶²ç«™åŸºç¤URL</li>
                </ul>
            </div>
        </div>

        <div class="step">
            <h3>âœ… å®Œæˆæª¢æŸ¥æ¸…å–®</h3>
            <div class="success-box">
                <h4>è«‹ç¢ºèªä»¥ä¸‹é …ç›®ï¼š</h4>
                <ul>
                    <li>âœ… åŸŸåå·²é…ç½®ä¸¦å¯è¨ªå•</li>
                    <li>âœ… HTTPS å·²å•Ÿç”¨</li>
                    <li>âœ… å¾®ä¿¡å…¬çœ¾è™Ÿæ˜¯å·²èªè­‰çš„æœå‹™è™Ÿ</li>
                    <li>âœ… ç¶²é æˆæ¬ŠåŸŸåå·²é…ç½®</li>
                    <li>âœ… ç’°å¢ƒè®Šé‡å·²è¨­ç½®</li>
                    <li>âœ… è‡ªå®šç¾©èœå–®å·²è¨­ç½®</li>
                    <li>âœ… åœ¨æ‰‹æ©Ÿå¾®ä¿¡ä¸­æ¸¬è©¦é€šé</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // æª¢æŸ¥ç³»çµ±ç‹€æ…‹
        async function checkSystemStatus() {
            try {
                const response = await fetch('/api/debug/env');
                const data = await response.json();
                console.log('ç³»çµ±é…ç½®:', data);
            } catch (error) {
                console.error('æª¢æŸ¥ç³»çµ±ç‹€æ…‹å¤±æ•—:', error);
            }
        }

        // é é¢åŠ è¼‰æ™‚æª¢æŸ¥ç‹€æ…‹
        document.addEventListener('DOMContentLoaded', checkSystemStatus);
    </script>
</body>
</html> 